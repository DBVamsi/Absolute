var GridEngine=(()=>{var t,e,i,r,n=Object.create,s=Object.defineProperty,o=Object.defineProperties,a=Object.getOwnPropertyDescriptor,h=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertyNames,c=Object.getOwnPropertySymbols,u=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,g=(t,e,i)=>e in t?s(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,f=(t,e)=>{for(var i in e||(e={}))d.call(e,i)&&g(t,i,e[i]);if(c)for(var i of c(e))p.call(e,i)&&g(t,i,e[i]);return t},y=(t,e)=>o(t,h(e)),m=(t,e)=>()=>(t&&(e=t(t=0)),e),v=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),T=t=>((t,e,i)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let r of l(e))!d.call(t,r)&&"default"!==r&&s(t,r,{get:()=>e[r],enumerable:!(i=a(e,r))||i.enumerable});return t})((t=>s(t,"__esModule",{value:!0}))(s(null!=t?n(u(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t),_=m(()=>{t=class{static get(){return t.config}static set(e){t.config=e}}}),P=m(()=>{!function(t){t.DONT_BLOCK="DONT_BLOCK",t.BLOCK_TWO_TILES="BLOCK_TWO_TILES",t.BLOCK_ONE_TILE_AHEAD="BLOCK_ONE_TILE_AHEAD",t.BLOCK_ONE_TILE_BEHIND="BLOCK_ONE_TILE_BEHIND"}(e||(e={}))}),b=m(()=>{(r=i=class{constructor(t,e){"number"==typeof t?(this.x=t,this.y=e||0):(this.x=t.x,this.y=t.y)}clone(){return new i(this.x,this.y)}add(t){return new i(this.x+t.x,this.y+t.y)}multiply(t){return new i(this.x*t.x,this.y*t.y)}divide(t){return new i(this.x/t.x,this.y/t.y)}subtract(t){return new i(this.x-t.x,this.y-t.y)}equals(t){return this.x===t.x&&this.y===t.y}abs(){return new i(Math.abs(this.x),Math.abs(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}toString(){return`${this.x}#${this.y}`}}).ZERO=new i(0,0),r.UP=new i(0,-1),r.DOWN=new i(0,1),r.LEFT=new i(-1,0),r.RIGHT=new i(1,0)});function S(t){return[w.DOWN_LEFT,w.DOWN_RIGHT,w.UP_RIGHT,w.UP_LEFT].includes(t)}function E(t){return{[w.UP]:r.UP.clone(),[w.DOWN]:r.DOWN.clone(),[w.LEFT]:r.LEFT.clone(),[w.RIGHT]:r.RIGHT.clone(),[w.NONE]:r.ZERO.clone(),[w.UP_LEFT]:new r(-1,-1),[w.UP_RIGHT]:new r(1,-1),[w.DOWN_RIGHT]:new r(1,1),[w.DOWN_LEFT]:new r(-1,1)}[t]}var w,O,x,C,D,R,N,I,L,M,F,A,k,W,H,G,B,U,$,j,Y,z,X,K,q,Z,V,J,Q,tt,et=m(()=>{b(),function(t){t.NONE="none",t.LEFT="left",t.UP_LEFT="up-left",t.UP="up",t.UP_RIGHT="up-right",t.RIGHT="right",t.DOWN_RIGHT="down-right",t.DOWN="down",t.DOWN_LEFT="down-left"}(w||(w={})),function(t){t[t.FOUR=4]="FOUR",t[t.EIGHT=8]="EIGHT"}(O||(O={}))}),it=m(()=>{b(),x=class{static vec2str(t){return`${t.x}#${t.y}`}static equal(t,e){return x.vec2str(t)==x.vec2str(e)}static manhattanDistance(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}static chebyshevDistance(t,e){let i=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return Math.max(i,r)}static scalarMult(t,e){return t.clone().multiply(new r(e,e))}}}),rt=m(()=>{et(),(D=C=class{constructor(t,e,i){this.sprite=t,this.walkingAnimationMapping=e,this.characterIndex=i,this.lastFootLeft=!1,this.directionToFrameRow={[w.DOWN]:0,[w.DOWN_LEFT]:1,[w.DOWN_RIGHT]:2,[w.LEFT]:1,[w.RIGHT]:2,[w.UP]:3,[w.UP_LEFT]:1,[w.UP_RIGHT]:2},this._isEnabled=!0}setIsEnabled(t){this._isEnabled=t}isEnabled(){return this._isEnabled}updateCharacterFrame(t,e){this._isEnabled&&(e?this.setStandingFrameDuringWalk(t):this.setWalkingFrame(t))}setStandingFrame(t){this._isEnabled&&this._setStandingFrame(t)}setWalkingAnimationMapping(t){this.walkingAnimationMapping=t,this._isEnabled=void 0!==this.walkingAnimationMapping}setCharacterIndex(t){this.characterIndex=t,this._isEnabled=-1!==this.characterIndex}getWalkingAnimationMapping(){return this.walkingAnimationMapping}getCharacterIndex(){return this.characterIndex}setStandingFrameDuringWalk(t){this.isCurrentFrameStanding(t)||(this.lastFootLeft=!this.lastFootLeft),this._setStandingFrame(t)}setWalkingFrame(t){let e=this.framesOfDirection(t);this.sprite.setFrame(this.lastFootLeft?e.rightFoot:e.leftFoot)}_setStandingFrame(t){this.sprite.setFrame(this.framesOfDirection(t).standing)}isCurrentFrameStanding(t){return Number(this.sprite.frame.name)==this.framesOfDirection(t).standing}framesOfDirection(t){return this.walkingAnimationMapping?this.getFramesForAnimationMapping(t):this.getFramesForCharIndex(t)}getFramesForAnimationMapping(t){return this.walkingAnimationMapping[t]||this.walkingAnimationMapping[this.fallbackDirection(t)]}fallbackDirection(t){switch(t){case w.DOWN_LEFT:return w.LEFT;case w.DOWN_RIGHT:return w.RIGHT;case w.UP_LEFT:return w.LEFT;case w.UP_RIGHT:return w.RIGHT}return t}getFramesForCharIndex(t){let e=this.sprite.texture.source[0].width/this.sprite.width/C.FRAMES_CHAR_ROW,i=Math.floor(this.characterIndex/e),r=this.characterIndex%e,n=e*C.FRAMES_CHAR_ROW,s=C.FRAMES_CHAR_ROW*r+(this.directionToFrameRow[t]+i*C.FRAMES_CHAR_COL)*n;return{rightFoot:s,standing:s+1,leftFoot:s+2}}}).FRAMES_CHAR_ROW=3,D.FRAMES_CHAR_COL=4}),nt=v((t,e)=>{var i,r,n,s,o,a,h,l,c,u,d,p,g,f,y,m,v,T,_,P,b,S,E,w;!function(t){var i="object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:{};function r(t,e){return t!==i&&("function"==typeof Object.create?Object.defineProperty(t,"__esModule",{value:!0}):t.__esModule=!0),function(i,r){return t[i]=e?e(i,r):r}}"function"==typeof define&&define.amd?define("tslib",["exports"],function(e){t(r(i,r(e)))}):"object"==typeof e&&"object"==typeof e.exports?t(r(i,r(e.exports))):t(r(i))}(function(t){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])};i=function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)},r=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},n=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]])}return i},s=function(t,e,i,r){var n,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o},o=function(t,e){return function(i,r){e(i,r,t)}},a=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h=function(t,e,i,r){return new(i||(i=Promise))(function(n,s){function o(t){try{h(r.next(t))}catch(t){s(t)}}function a(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){t.done?n(t.value):function(t){return t instanceof i?t:new i(function(e){e(t)})}(t.value).then(o,a)}h((r=r.apply(t,e||[])).next())})},l=function(t,e){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},c=function(t,e){for(var i in t)"default"!==i&&!Object.prototype.hasOwnProperty.call(e,i)&&w(e,t,i)},w=Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]},u=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},d=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,s=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},p=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(d(arguments[e]));return t},g=function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var r=Array(t),n=0;for(e=0;e<i;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)r[n]=s[o];return r},f=function(t,e){for(var i=0,r=e.length,n=t.length;i<r;i++,n++)t[n]=e[i];return t},y=function(t){return this instanceof y?(this.v=t,this):new y(t)},m=function(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,n=i.apply(t,e||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(t){n[t]&&(r[t]=function(e){return new Promise(function(i,r){s.push([t,e,i,r])>1||a(t,e)})})}function a(t,e){try{!function(t){t.value instanceof y?Promise.resolve(t.value.v).then(h,l):c(s[0][2],t)}(n[t](e))}catch(t){c(s[0][3],t)}}function h(t){a("next",t)}function l(t){a("throw",t)}function c(t,e){t(e),s.shift(),s.length&&a(s[0][0],s[0][1])}},v=function(t){var e,i;return e={},r("next"),r("throw",function(t){throw t}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,n){e[r]=t[r]?function(e){return(i=!i)?{value:y(t[r](e)),done:"return"===r}:n?n(e):e}:n}},T=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=u(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(e){return new Promise(function(r,n){(function(t,e,i,r){Promise.resolve(r).then(function(e){t({value:e,done:i})},e)})(r,n,(e=t[i](e)).done,e.value)})}}},_=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t};var O=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};P=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&w(e,t,i);return O(e,t),e},b=function(t){return t&&t.__esModule?t:{default:t}},S=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},E=function(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,i),i},t("__extends",i),t("__assign",r),t("__rest",n),t("__decorate",s),t("__param",o),t("__metadata",a),t("__awaiter",h),t("__generator",l),t("__exportStar",c),t("__createBinding",w),t("__values",u),t("__read",d),t("__spread",p),t("__spreadArrays",g),t("__spreadArray",f),t("__await",y),t("__asyncGenerator",m),t("__asyncDelegator",v),t("__asyncValues",T),t("__makeTemplateObject",_),t("__importStar",P),t("__importDefault",b),t("__classPrivateFieldGet",S),t("__classPrivateFieldSet",E)})}),st=m(()=>{R=T(nt()),({__extends:N,__assign:I,__rest:L,__decorate:M,__param:F,__metadata:A,__awaiter:k,__generator:W,__exportStar:H,__createBinding:G,__values:B,__read:U,__spread:$,__spreadArrays:j,__spreadArray:Y,__await:z,__asyncGenerator:X,__asyncDelegator:K,__asyncValues:q,__makeTemplateObject:Z,__importStar:V,__importDefault:J,__classPrivateFieldGet:Q,__classPrivateFieldSet:tt}=R.default)});function ot(t){return"function"==typeof t}var at=m(()=>{});function ht(t){var e=t(function(t){Error.call(t),t.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var lt,ct=m(()=>{}),ut=m(()=>{ct(),lt=ht(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}})});function dt(t,e){if(t){var i=t.indexOf(e);0<=i&&t.splice(i,1)}}var pt=m(()=>{});function gt(t){return t instanceof yt||t&&"closed"in t&&ot(t.remove)&&ot(t.add)&&ot(t.unsubscribe)}function ft(t){ot(t)?t():t.unsubscribe()}var yt,mt,vt,Tt,_t=m(()=>{st(),at(),ut(),pt(),yt=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}return t.prototype.unsubscribe=function(){var t,e,i,r,n;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=B(s),a=o.next();!a.done;a=o.next()){a.value.remove(this)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else s.remove(this);var h=this.initialTeardown;if(ot(h))try{h()}catch(t){n=t instanceof lt?t.errors:[t]}var l=this._teardowns;if(l){this._teardowns=null;try{for(var c=B(l),u=c.next();!u.done;u=c.next()){var d=u.value;try{ft(d)}catch(t){n=null!=n?n:[],t instanceof lt?n=Y(Y([],U(n),!1),U(t.errors),!1):n.push(t)}}}catch(t){i={error:t}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(i)throw i.error}}}if(n)throw new lt(n)}},t.prototype.add=function(e){var i;if(e&&e!==this)if(this.closed)ft(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(i=this._teardowns)&&void 0!==i?i:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&dt(e,t)},t.prototype.remove=function(e){var i=this._teardowns;i&&dt(i,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t;var e}(),mt=yt.EMPTY}),Pt=m(()=>{vt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}}),bt=m(()=>{st(),Tt={setTimeout:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Tt.delegate;return((null==i?void 0:i.setTimeout)||setTimeout).apply(void 0,Y([],U(t),!1))},clearTimeout:function(t){var e=Tt.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0}});function St(t){Tt.setTimeout(function(){var e=vt.onUnhandledError;if(!e)throw t;e(t)})}var Et=m(()=>{Pt(),bt()});function wt(){}var Ot=m(()=>{});function xt(t,e,i){return{kind:t,value:e,error:i}}var Ct,Dt=m(()=>{Ct=xt("C",void 0,void 0)});function Rt(t){if(vt.useDeprecatedSynchronousErrorHandling){var e=!Nt;if(e&&(Nt={errorThrown:!1,error:null}),t(),e){var i=Nt,r=i.errorThrown,n=i.error;if(Nt=null,r)throw n}}else t()}var Nt,It=m(()=>{Pt(),Nt=null});function Lt(t,e){return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];try{t.apply(void 0,Y([],U(e),!1))}catch(t){vt.useDeprecatedSynchronousErrorHandling?function(t){vt.useDeprecatedSynchronousErrorHandling&&Nt&&(Nt.errorThrown=!0,Nt.error=t)}(t):St(t)}}}function Mt(t){throw t}function Ft(t,e){var i=vt.onStoppedNotification;i&&Tt.setTimeout(function(){return i(t,e)})}var At,kt,Wt,Ht,Gt=m(()=>{st(),at(),_t(),Pt(),Et(),Ot(),Dt(),bt(),It(),At=function(t){function e(e){var i=t.call(this)||this;return i.isStopped=!1,e?(i.destination=e,gt(e)&&e.add(i)):i.destination=Wt,i}return N(e,t),e.create=function(t,e,i){return new kt(t,e,i)},e.prototype.next=function(t){this.isStopped?Ft(xt("N",t,void 0),this):this._next(t)},e.prototype.error=function(t){this.isStopped?Ft(xt("E",void 0,t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?Ft(Ct,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(yt),kt=function(t){function e(e,i,r){var n,s=t.call(this)||this;if(ot(e))n=e;else if(e){var o;n=e.next,i=e.error,r=e.complete,s&&vt.useDeprecatedNextContext?(o=Object.create(e)).unsubscribe=function(){return s.unsubscribe()}:o=e,n=null==n?void 0:n.bind(o),i=null==i?void 0:i.bind(o),r=null==r?void 0:r.bind(o)}return s.destination={next:n?Lt(n):wt,error:Lt(null!=i?i:Mt),complete:r?Lt(r):wt},s}return N(e,t),e}(At),Wt={closed:!0,next:wt,error:Mt,complete:wt}}),Bt=m(()=>{Ht="function"==typeof Symbol&&Symbol.observable||"@@observable"});function Ut(t){return t}var $t=m(()=>{});var jt=m(()=>{$t()});function Yt(t){var e;return null!==(e=null!=t?t:vt.Promise)&&void 0!==e?e:Promise}function zt(t){return t&&t instanceof At||function(t){return t&&ot(t.next)&&ot(t.error)&&ot(t.complete)}(t)&&gt(t)}var Xt,Kt=m(()=>{Gt(),_t(),Bt(),jt(),Pt(),at(),It(),Xt=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var i=new t;return i.source=this,i.operator=e,i},t.prototype.subscribe=function(t,e,i){var r=this,n=zt(t)?t:new kt(t,e,i);return Rt(function(){var t=r,e=t.operator,i=t.source;n.add(e?e.call(n,i):i?r._subscribe(n):r._trySubscribe(n))}),n},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var i=this;return new(e=Yt(e))(function(e,r){var n;n=i.subscribe(function(e){try{t(e)}catch(t){r(t),null==n||n.unsubscribe()}},r,e)})},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[Ht]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0===(i=t).length?Ut:1===i.length?i[0]:function(t){return i.reduce(function(t,e){return e(t)},t)})(this);var i},t.prototype.toPromise=function(t){var e=this;return new(t=Yt(t))(function(t,i){var r;e.subscribe(function(t){return r=t},function(t){return i(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}()});function qt(t){return function(e){if(function(t){return ot(null==t?void 0:t.lift)}(e))return e.lift(function(e){try{return t(e,this)}catch(t){this.error(t)}});throw new TypeError("Unable to lift unknown Observable type")}}var Zt,Vt,Jt,Qt,te,ee,ie=m(()=>{at()}),re=m(()=>{st(),Gt(),Zt=function(t){function e(e,i,r,n,s){var o=t.call(this,e)||this;return o.onFinalize=s,o._next=i?function(t){try{i(t)}catch(t){e.error(t)}}:t.prototype._next,o._error=n?function(t){try{n(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,o._complete=r?function(){try{r()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,o}return N(e,t),e.prototype.unsubscribe=function(){var e,i=this.closed;t.prototype.unsubscribe.call(this),!i&&(null===(e=this.onFinalize)||void 0===e||e.call(this))},e}(At)}),ne=m(()=>{ct(),Vt=ht(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})}),se=m(()=>{st(),Kt(),_t(),ne(),pt(),It(),Jt=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return N(e,t),e.prototype.lift=function(t){var e=new Qt(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new Vt},e.prototype.next=function(t){var e=this;Rt(function(){var i,r;if(e._throwIfClosed(),!e.isStopped){var n=e.observers.slice();try{for(var s=B(n),o=s.next();!o.done;o=s.next()){o.value.next(t)}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var e=this;Rt(function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var i=e.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;Rt(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,i=e.hasError,r=e.isStopped,n=e.observers;return i||r?mt:(n.push(t),new yt(function(){return dt(n,t)}))},e.prototype._checkFinalizedStatuses=function(t){var e=this,i=e.hasError,r=e.thrownError,n=e.isStopped;i?t.error(r):n&&t.complete()},e.prototype.asObservable=function(){var t=new Xt;return t.source=this,t},e.create=function(t,e){return new Qt(t,e)},e}(Xt),Qt=function(t){function e(e,i){var r=t.call(this)||this;return r.destination=e,r.source=i,r}return N(e,t),e.prototype.next=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)},e.prototype.error=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:mt},e}(Jt)}),oe=m(()=>{Kt(),te=new Xt(function(t){return t.complete()})}),ae=m(()=>{ee=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t}});var he=m(()=>{at()});var le=m(()=>{Bt(),at()});var ce=m(()=>{at()});var ue=m(()=>{});var de,pe=m(()=>{de="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"});var ge=m(()=>{pe(),at()});var fe=m(()=>{st(),at()});function ye(t){if(t instanceof Xt)return t;if(null!=t){if(function(t){return ot(t[Ht])}(t))return function(t){return new Xt(function(e){var i=t[Ht]();if(ot(i.subscribe))return i.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(ee(t))return function(t){return new Xt(function(e){for(var i=0;i<t.length&&!e.closed;i++)e.next(t[i]);e.complete()})}(t);if(function(t){return ot(null==t?void 0:t.then)}(t))return function(t){return new Xt(function(e){t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,St)})}(t);if(function(t){return Symbol.asyncIterator&&ot(null==t?void 0:t[Symbol.asyncIterator])}(t))return me(t);if(function(t){return ot(null==t?void 0:t[de])}(t))return function(t){return new Xt(function(e){var i,r;try{for(var n=B(t),s=n.next();!s.done;s=n.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}e.complete()})}(t);if(function(t){return ot(null==t?void 0:t.getReader)}(t))return function(t){return me(function(t){return X(this,arguments,function(){var e,i,r;return W(this,function(n){switch(n.label){case 0:e=t.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,z(e.read())];case 3:return i=n.sent(),r=i.value,i.done?[4,z(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,z(r)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}(t))}(t)}throw function(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}(t)}function me(t){return new Xt(function(e){(function(t,e){var i,r,n,s;return k(this,void 0,void 0,function(){var o,a;return W(this,function(h){switch(h.label){case 0:h.trys.push([0,5,6,11]),i=q(t),h.label=1;case 1:return[4,i.next()];case 2:if((r=h.sent()).done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];h.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=h.sent(),n={error:a},[3,11];case 6:return h.trys.push([6,,9,10]),r&&!r.done&&(s=i.return)?[4,s.call(i)]:[3,8];case 7:h.sent(),h.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})})(t,e).catch(function(t){return e.error(t)})})}var ve=m(()=>{st(),ae(),he(),Kt(),le(),ce(),ue(),ge(),fe(),at(),Et(),Bt()});var Te=m(()=>{ie(),re()});var _e=m(()=>{ie(),re()}),Pe=m(()=>{});function be(t){return t<=0?function(){return te}:qt(function(e,i){var r=0;e.subscribe(new Zt(i,function(e){++r<=t&&(i.next(e),t<=r&&i.complete())}))})}var Se=m(()=>{oe(),ie(),re()});function Ee(t){return qt(function(e,i){ye(t).subscribe(new Zt(i,function(){return i.complete()},wt)),!i.closed&&e.subscribe(i)})}var we,Oe,xe,Ce,De,Re,Ne,Ie,Le,Me,Fe,Ae,ke,We,He,Ge,Be,Ue=m(()=>{ie(),re(),ve(),Ot()}),$e=m(()=>{se(),Pe(),Se()}),je=m(()=>{rt(),it(),et(),et(),$e(),b(),we=class{constructor(t,e){this.id=t,this.movementDirection=w.NONE,this.tileSizePixelsWalked=r.ZERO.clone(),this._nextTilePos={position:new r(0,0),layer:void 0},this._tilePos={position:new r(0,0),layer:void 0},this.movementStarted$=new Jt,this.movementStopped$=new Jt,this.directionChanged$=new Jt,this.positionChangeStarted$=new Jt,this.positionChangeFinished$=new Jt,this.tilePositionSet$=new Jt,this.autoMovementSet$=new Jt,this.lastMovementImpulse=w.NONE,this.facingDirection=w.DOWN,this.characterIndex=-1,"number"==typeof e.walkingAnimationMapping?this.characterIndex=e.walkingAnimationMapping:this.walkingAnimationMapping=e.walkingAnimationMapping,this.container=e.container,this.tilemap=e.tilemap,this.speed=e.speed,this.collides=e.collides,this.customOffset=new r(e.offsetX||0,e.offsetY||0),this.tileSize=e.tileSize.clone(),this._tilePos.layer=e.charLayer,this.sprite=e.sprite,this._setSprite(this.sprite)}getId(){return this.id}getSpeed(){return this.speed}setSpeed(t){this.speed=t}getSprite(){return this.sprite}setSprite(t){this._setSprite(t)}setMovement(t){var e;this.autoMovementSet$.next(),this.movement=t,null==(e=this.movement)||e.setCharacter(this)}getMovement(){return this.movement}getCollides(){return this.collides}setWalkingAnimationMapping(t){"number"==typeof t?this.animation.setCharacterIndex(t):this.animation.setWalkingAnimationMapping(t)}setTilePosition(t){this.isMoving()&&this.movementStopped$.next(this.movementDirection),this.tilePositionSet$.next(f({},t)),this.positionChangeStarted$.next({exitTile:this.tilePos.position,enterTile:t.position,exitLayer:this.tilePos.layer,enterLayer:t.layer}),this.positionChangeFinished$.next({exitTile:this.tilePos.position,enterTile:t.position,exitLayer:this.tilePos.layer,enterLayer:t.layer}),this.movementDirection=w.NONE,this.lastMovementImpulse=w.NONE,this.nextTilePos=t,this.tilePos=t,this.updateZindex(),this.setPosition(this.tilePosToPixelPos(t.position).add(this.getOffset()).add(this.customOffset))}getTilePos(){return this.tilePos}getNextTilePos(){return this.nextTilePos}move(t){this.lastMovementImpulse=t,t!=w.NONE&&(this.isMoving()||(this.isBlockingDirection(t)?(this.facingDirection=t,this.animation.setStandingFrame(t),this.directionChanged$.next(t)):this.startMoving(t)))}update(t){var e;null==(e=this.movement)||e.update(t),this.isMoving()&&(this.updateCharacterPosition(t),this.updateZindex()),this.lastMovementImpulse=w.NONE}getMovementDirection(){return this.movementDirection}isBlockingDirection(t){if(t==w.NONE||!this.collides)return!1;let e=this.tilePosInDirection(t),i=this.tilemap.getTransition(e,this.nextTilePos.layer)||this.nextTilePos.layer,r=this.tilemap.hasBlockingTile(i,e,(s=this.toMapDirection(t),{[w.UP]:w.DOWN,[w.DOWN]:w.UP,[w.LEFT]:w.RIGHT,[w.RIGHT]:w.LEFT,[w.NONE]:w.NONE,[w.UP_LEFT]:w.DOWN_RIGHT,[w.UP_RIGHT]:w.DOWN_LEFT,[w.DOWN_RIGHT]:w.UP_LEFT,[w.DOWN_LEFT]:w.UP_RIGHT}[s])),n=this.tilemap.hasBlockingChar(e,i);var s;return r||n}isMoving(){return this.movementDirection!=w.NONE}turnTowards(t){this.isMoving()||t!=w.NONE&&(this.facingDirection=t,this.animation.setStandingFrame(t))}getFacingDirection(){return this.facingDirection}getFacingPosition(){return this._tilePos.position.add(E(this.facingDirection))}movementStarted(){return this.movementStarted$}movementStopped(){return this.movementStopped$}directionChanged(){return this.directionChanged$}tilePositionSet(){return this.tilePositionSet$}positionChangeStarted(){return this.positionChangeStarted$}positionChangeFinished(){return this.positionChangeFinished$}autoMovementSet(){return this.autoMovementSet$}isColliding(){return this.collides}tilePosToPixelPos(t){return t.clone().multiply(this.tileSize)}getTileDistance(t){return this.tileSize.clone()}toMapDirection(t){return t}_setSprite(t){t.setOrigin(0,0),t.x=this.sprite.x,t.y=this.sprite.y,this.sprite=t,this.animation=new D(this.sprite,this.walkingAnimationMapping,this.characterIndex),this.animation.setIsEnabled(void 0!==this.walkingAnimationMapping||-1!==this.characterIndex),this.animation.setStandingFrame(w.DOWN),this.updateZindex()}getOffset(){let t=this.tileSize.x/2-Math.floor(this.sprite.width*this.sprite.scale/2),e=-this.sprite.height*this.sprite.scale+this.tileSize.y;return new r(t,e)}createSpeedPixelsPerSecond(){let t={[w.LEFT]:new r(this.tileSize.x,0),[w.RIGHT]:new r(this.tileSize.x,0),[w.UP]:new r(0,this.tileSize.y),[w.DOWN]:new r(0,this.tileSize.y),[w.UP_LEFT]:this.getTileDistance(w.UP_LEFT),[w.UP_RIGHT]:this.getTileDistance(w.UP_RIGHT),[w.DOWN_LEFT]:this.getTileDistance(w.DOWN_LEFT),[w.DOWN_RIGHT]:this.getTileDistance(w.DOWN_RIGHT),[w.NONE]:r.ZERO.clone()};return Object.entries(t).forEach(([e,i])=>{t[e]=x.scalarMult(i,this.speed)}),t}get nextTilePos(){return{position:this._nextTilePos.position.clone(),layer:this._nextTilePos.layer}}set nextTilePos(t){this._nextTilePos.position.x=t.position.x,this._nextTilePos.position.y=t.position.y,this._nextTilePos.layer=t.layer}get tilePos(){return{position:this._tilePos.position.clone(),layer:this._tilePos.layer}}set tilePos(t){this._tilePos.position.x=t.position.x,this._tilePos.position.y=t.position.y,this._tilePos.layer=t.layer}updateZindex(){(this.container||this.sprite).setDepth(this.tilemap.getDepthOfCharLayer(this.nextTilePos.layer)+this.mapDepth(this.nextTilePos))}mapDepth(t){return t.position.y}setPosition(t){let e=this.container||this.sprite;e.x=t.x,e.y=t.y}getPosition(){let t=this.container||this.sprite;return new r(t.x,t.y)}startMoving(t){t!==w.NONE&&(t!=this.movementDirection&&this.movementStarted$.next(t),this.movementDirection=t,this.facingDirection=t,this.updateTilePos())}updateTilePos(){this.tilePos=this.nextTilePos;let t=this.tilePosInDirection(this.movementDirection),e=this.tilemap.getTransition(t,this.tilePos.layer)||this.tilePos.layer;this.nextTilePos={position:t,layer:e},this.positionChangeStarted$.next({exitTile:this.tilePos.position,enterTile:t,exitLayer:this.tilePos.layer,enterLayer:e})}tilePosInDirection(t){return this.nextTilePos.position.add(E(this.toMapDirection(t)))}getDistToNextTile(){return this.getTileDistance(this.movementDirection).clone().subtract(this.tileSizePixelsWalked).multiply(E(this.movementDirection))}updateCharacterPosition(t){let e=this.getSpeedPerDelta(t),i=this.getDistToNextTile(),r=i.length()<=e.length(),n=r?i:e;this.moveCharacterSprite(n),r&&(this.shouldContinueMoving()?(this.positionChangeFinished$.next({exitTile:this.tilePos.position,enterTile:this.nextTilePos.position,exitLayer:this.tilePos.layer,enterLayer:this.nextTilePos.layer}),this.startMoving(this.lastMovementImpulse),this.updateCharacterPosition(t*this.getProportionWalked(e,i))):this.stopMoving())}getProportionWalked(t,e){let i=t.subtract(e).divide(t);return isNaN(i.x)&&(i.x=0),Math.max(Math.abs(i.x),Math.abs(i.y))}shouldContinueMoving(){return this.lastMovementImpulse!==w.NONE&&!this.isBlockingDirection(this.lastMovementImpulse)}getSpeedPerDelta(t){let e=t/1e3;return this.createSpeedPixelsPerSecond()[this.movementDirection].clone().multiply(new r(e,e)).multiply(E(this.movementDirection))}moveCharacterSprite(t){let e=this.getPosition().add(t);this.setPosition(e),this.tileSizePixelsWalked.x+=Math.abs(t.x),this.tileSizePixelsWalked.y+=Math.abs(t.y),this.animation.updateCharacterFrame(this.movementDirection,this.hasWalkedHalfATile()),this.tileSizePixelsWalked.x%=this.getTileDistance(this.movementDirection).x,this.tileSizePixelsWalked.y%=this.getTileDistance(this.movementDirection).y}stopMoving(){if(this.movementDirection===w.NONE)return;let t=this.tilePos,e=this.nextTilePos,i=this.movementDirection;this.tilePos=this.nextTilePos,this.movementDirection=w.NONE,this.movementStopped$.next(i),this.positionChangeFinished$.next({exitTile:t.position,enterTile:e.position,exitLayer:t.layer,enterLayer:e.layer})}hasWalkedHalfATile(){return this.tileSizePixelsWalked.x>this.getTileDistance(this.movementDirection).x/2||this.tileSizePixelsWalked.y>this.getTileDistance(this.movementDirection).y/2}}}),Ye=m(()=>{et(),b(),it(),je(),Oe=class extends we{tilePosToPixelPos(t){return this.getTileDistance(w.UP_LEFT).multiply(new r(t.x-t.y,t.x+t.y))}getTileDistance(t){switch(t){case w.DOWN_LEFT:case w.DOWN_RIGHT:case w.UP_LEFT:case w.UP_RIGHT:return x.scalarMult(this.tileSize,.5);default:return super.getTileDistance(t)}}toMapDirection(t){return e=t,{[w.LEFT]:w.DOWN_LEFT,[w.UP_LEFT]:w.LEFT,[w.UP]:w.UP_LEFT,[w.UP_RIGHT]:w.UP,[w.RIGHT]:w.UP_RIGHT,[w.DOWN_RIGHT]:w.RIGHT,[w.DOWN]:w.DOWN_RIGHT,[w.DOWN_LEFT]:w.DOWN,[w.NONE]:w.NONE}[e];var e}mapDepth(t){return t.position.x+t.position.y}}}),ze=m(()=>{_e(),Te(),Se(),Ue()}),Xe=m(()=>{it(),xe=class{getShortestPath(t,e,i){let r=this.shortestPathBfs(t,e,i);return{path:this.returnPath(r.previous,t,e),closestToTarget:r.closestToTarget}}distance(t,e){return x.manhattanDistance(t.position,e.position)}pos2Str(t){return`${t.position.toString()}#${t.layer}`}equal(t,e){return!!x.equal(t.position,e.position)&&t.layer===e.layer}shortestPathBfs(t,e,i){let r=new Map,n=new Set,s=[],o=t,a=this.distance(t,e);for(s.push({node:t,dist:0}),n.add(this.pos2Str(t));s.length>0;){let{node:t,dist:h}=s.shift(),l=this.distance(t,e);if(l<a&&(a=l,o=t),this.equal(t,e))return{shortestDistance:h,previous:r,closestToTarget:o};for(let e of i(t))n.has(this.pos2Str(e))||(r.set(this.pos2Str(e),t),s.push({node:e,dist:h+1}),n.add(this.pos2Str(e)))}return{shortestDistance:-1,previous:r,closestToTarget:o}}returnPath(t,e,i){let r=[],n=i;for(r.push(n);!this.equal(n,e);){if(!(n=t.get(this.pos2Str(n))))return[];r.push(n)}return r.reverse()}}}),Ke=m(()=>{Ce=class{constructor(t,e,i){this.backoffMs=t,this.maxRetries=e,this.onFinished=i,this.retries=0,this.elapsed=0}retry(t,e){this.shouldRetry()?(this.elapsed+=t,this.elapsed>=this.backoffMs&&(this.elapsed=0,this.retries++,e())):this.onFinished()}reset(){this.retries=0,this.elapsed=0}getMaxRetries(){return this.maxRetries}shouldRetry(){return-1===this.maxRetries||this.retries<this.maxRetries}}}),qe=m(()=>{it(),et(),b(),De=class{distance(t,e){return x.chebyshevDistance(t,e)}neighbours(t){return[...[new r(t.x,t.y+1),new r(t.x+1,t.y),new r(t.x-1,t.y),new r(t.x,t.y-1)],...[new r(t.x+1,t.y+1),new r(t.x+1,t.y-1),new r(t.x-1,t.y+1),new r(t.x-1,t.y-1)]]}direction(t,e){return e.x>t.x?e.y>t.y?w.DOWN_RIGHT:e.y<t.y?w.UP_RIGHT:w.RIGHT:e.x<t.x?e.y>t.y?w.DOWN_LEFT:e.y<t.y?w.UP_LEFT:w.LEFT:e.y<t.y?w.UP:e.y>t.y?w.DOWN:w.NONE}}}),Ze=m(()=>{it(),et(),b(),Re=class{distance(t,e){return x.manhattanDistance(t,e)}direction(t,e){if(x.equal(t,e))return w.NONE;let i=t.clone().subtract(e);return Math.abs(i.x)>Math.abs(i.y)?i.x>0?w.LEFT:w.RIGHT:i.y>0?w.UP:w.DOWN}neighbours(t){return[new r(t.x,t.y+1),new r(t.x+1,t.y),new r(t.x-1,t.y),new r(t.x,t.y-1)]}}}),Ve=m(()=>{!function(t){t.STOP="STOP",t.CLOSEST_REACHABLE="CLOSEST_REACHABLE",t.RETRY="RETRY"}(Ne||(Ne={}))}),Je=m(()=>{!function(t){t.WAIT="WAIT",t.RETRY="RETRY",t.STOP="STOP"}(Ie||(Ie={}))}),Qe=m(()=>{et(),Xe(),Ke(),qe(),Ze(),Ve(),Je(),$e(),function(t){t.SUCCESS="SUCCESS",t.NO_PATH_FOUND_MAX_RETRIES_EXCEEDED="NO_PATH_FOUND_MAX_RETRIES_EXCEEDED",t.PATH_BLOCKED_MAX_RETRIES_EXCEEDED="PATH_BLOCKED_MAX_RETRIES_EXCEEDED",t.PATH_BLOCKED="PATH_BLOCKED",t.NO_PATH_FOUND="NO_PATH_FOUND",t.PATH_BLOCKED_WAIT_TIMEOUT="PATH_BLOCKED_WAIT_TIMEOUT",t.MOVEMENT_TERMINATED="MOVEMENT_TERMINATED"}(Le||(Le={})),Me=class{constructor(t,e,i=0,r){this.tilemap=t,this.targetPos=e,this.distance=i,this.posOnPath=0,this.stopped=!1,this.distanceUtils=new Re,this.getNeighbours=(t=>this.distanceUtils.neighbours(t.position).filter(e=>!this.isBlocking(e,t.layer)).map(e=>{return{position:e,layer:this.tilemap.getTransition(e,t.layer)||t.layer}})),this.isBlocking=((t,e)=>{var i;return(null==(i=this.character)?void 0:i.getCollides())?!t||this.tilemap.isBlocking(e,t):!t||!this.tilemap.isInRange(t)}),this.noPathFoundStrategy=(null==r?void 0:r.noPathFoundStrategy)||Ne.STOP,this.pathBlockedStrategy=(null==r?void 0:r.pathBlockedStrategy)||Ie.WAIT,this.noPathFoundRetryable=new Ce((null==r?void 0:r.noPathFoundRetryBackoffMs)||200,(null==r?void 0:r.noPathFoundMaxRetries)||-1,()=>{this.stop(Le.NO_PATH_FOUND_MAX_RETRIES_EXCEEDED)}),this.pathBlockedRetryable=new Ce((null==r?void 0:r.pathBlockedRetryBackoffMs)||200,(null==r?void 0:r.pathBlockedMaxRetries)||-1,()=>{this.stop(Le.PATH_BLOCKED_MAX_RETRIES_EXCEEDED)}),this.pathBlockedWaitTimeoutMs=(null==r?void 0:r.pathBlockedWaitTimeoutMs)||-1,this.finished$=new Jt}setPathBlockedStrategy(t){this.pathBlockedStrategy=t}getPathBlockedStrategy(){return this.pathBlockedStrategy}setNumberOfDirections(t){t===O.EIGHT?this.distanceUtils=new De:this.distanceUtils=new Re}setCharacter(t){this.character=t,this.noPathFoundRetryable.reset(),this.pathBlockedRetryable.reset(),this.pathBlockedWaitElapsed=0,this.calcShortestPath(),this.character.autoMovementSet().pipe(be(1)).subscribe(()=>{this.stop(Le.MOVEMENT_TERMINATED)})}update(t){var e,i,r,n;this.stopped||(this.noPathFound()&&(this.noPathFoundStrategy===Ne.RETRY?this.noPathFoundRetryable.retry(t,()=>this.calcShortestPath()):this.noPathFoundStrategy===Ne.STOP&&this.stop(Le.NO_PATH_FOUND)),this.updatePosOnPath(),this.isBlocking(null==(e=this.nextTileOnPath())?void 0:e.position,null==(i=this.character)?void 0:i.getNextTilePos().layer)?this.applyPathBlockedStrategy(t):this.pathBlockedWaitElapsed=0,this.hasArrived()?(this.stop(Le.SUCCESS),this.existsDistToTarget()&&this.turnTowardsTarget()):this.isBlocking(null==(r=this.nextTileOnPath())?void 0:r.position,null==(n=this.character)?void 0:n.getNextTilePos().layer)||this.moveCharOnPath())}finishedObs(){return this.finished$}resultToReason(t){switch(t){case Le.SUCCESS:return"Successfully arrived.";case Le.MOVEMENT_TERMINATED:return"Movement of character has been replaced before destination was reached.";case Le.PATH_BLOCKED:return"PathBlockedStrategy STOP: Path blocked.";case Le.NO_PATH_FOUND_MAX_RETRIES_EXCEEDED:return`NoPathFoundStrategy RETRY: Maximum retries of ${this.noPathFoundRetryable.getMaxRetries()} exceeded.`;case Le.NO_PATH_FOUND:return"NoPathFoundStrategy STOP: No path found.";case Le.PATH_BLOCKED_MAX_RETRIES_EXCEEDED:return`PathBlockedStrategy RETRY: Maximum retries of ${this.pathBlockedRetryable.getMaxRetries()} exceeded.`;case Le.PATH_BLOCKED_WAIT_TIMEOUT:return`PathBlockedStrategy WAIT: Wait timeout of ${this.pathBlockedWaitTimeoutMs}ms exceeded.`}}applyPathBlockedStrategy(t){this.pathBlockedStrategy===Ie.RETRY?this.pathBlockedRetryable.retry(t,()=>this.calcShortestPath()):this.pathBlockedStrategy===Ie.STOP?this.stop(Le.PATH_BLOCKED):this.pathBlockedStrategy===Ie.WAIT&&this.pathBlockedWaitTimeoutMs>-1&&(this.pathBlockedWaitElapsed+=t,this.pathBlockedWaitElapsed>=this.pathBlockedWaitTimeoutMs&&this.stop(Le.PATH_BLOCKED_WAIT_TIMEOUT))}moveCharOnPath(){let t=this.getDir(this.character.getNextTilePos().position,this.nextTileOnPath().position);this.character.move(t)}nextTileOnPath(){return this.shortestPath[this.posOnPath+1]}stop(t){this.finished$.next({position:this.character.getTilePos().position,result:t,description:this.resultToReason(t),layer:this.character.getTilePos().layer}),this.finished$.complete(),this.stopped=!0}turnTowardsTarget(){let t=this.shortestPath[this.posOnPath+1],e=this.getDir(this.character.getNextTilePos().position,t.position);this.character.turnTowards(e)}existsDistToTarget(){return this.posOnPath<this.shortestPath.length-1}hasArrived(){return!this.noPathFound()&&this.posOnPath+Math.max(0,this.distance-this.distOffset)>=this.shortestPath.length-1}updatePosOnPath(){let t=this.shortestPath[this.posOnPath];for(;this.posOnPath<this.shortestPath.length-1&&(this.character.getNextTilePos().position.x!=t.position.x||this.character.getNextTilePos().position.y!=t.position.y);)this.posOnPath++,t=this.shortestPath[this.posOnPath]}noPathFound(){return 0===this.shortestPath.length}calcShortestPath(){let t=this.getShortestPath();this.posOnPath=0,this.shortestPath=t.path,this.distOffset=t.distOffset}getShortestPath(){let t=new xe,{path:e,closestToTarget:i}=t.getShortestPath(this.character.getNextTilePos(),this.targetPos,this.getNeighbours);if(0==e.length&&this.noPathFoundStrategy===Ne.CLOSEST_REACHABLE){return{path:t.getShortestPath(this.character.getNextTilePos(),i,this.getNeighbours).path,distOffset:this.distanceUtils.distance(i.position,this.targetPos.position)}}return{path:e,distOffset:0}}getDir(t,e){return this.distanceUtils.direction(t,e)}}}),ti=m(()=>{ze(),et(),Qe(),b(),Ve(),Fe=class{constructor(t,e,i=0,r=Ne.STOP){this.gridTilemap=t,this.charToFollow=e,this.distance=i,this.noPathFoundStrategy=r,this.numberOfDirections=O.FOUR}setNumberOfDirections(t){this.numberOfDirections=t}setCharacter(t){this.character=t,this.updateTarget(this.charToFollow.getTilePos().position,this.charToFollow.getTilePos().layer),this.charToFollow.positionChangeStarted().pipe(Ee(this.character.autoMovementSet())).subscribe(({enterTile:t,enterLayer:e})=>{this.updateTarget(t,e)})}update(t){var e;null==(e=this.targetMovement)||e.update(t)}updateTarget(t,e){this.targetMovement=new Me(this.gridTilemap,{position:new r(t),layer:e},this.distance+1,{noPathFoundStrategy:this.noPathFoundStrategy}),this.targetMovement.setNumberOfDirections(this.numberOfDirections),this.targetMovement.setCharacter(this.character)}}}),ei=m(()=>{_(),P(),Ae=class{constructor(){this.tilePosToCharacters=new Map,this.positionChangeStartedSubs=new Map,this.tilePosSetSubs=new Map,this.positionChangeFinishedSubs=new Map}isCharBlockingAt(t,e){let i=this.posToString(t,e);return this.tilePosToCharacters.has(i)&&this.tilePosToCharacters.get(i).size>0&&[...this.tilePosToCharacters.get(i)].some(t=>t.isColliding())}addCharacter(t){this.add(this.posToString(t.getTilePos().position,t.getTilePos().layer),t),this.add(this.posToString(t.getNextTilePos().position,t.getNextTilePos().layer),t),this.addPositionChangeSub(t),this.addPositionChangeFinishedSub(t),this.addTilePosSetSub(t)}removeCharacter(t){let e=t.getId();this.positionChangeStartedSubs.get(e).unsubscribe(),this.positionChangeFinishedSubs.get(e).unsubscribe(),this.tilePosSetSubs.get(e).unsubscribe(),this.tilePosToCharacters.get(this.posToString(t.getTilePos().position,t.getTilePos().layer)).delete(t),this.tilePosToCharacters.get(this.posToString(t.getNextTilePos().position,t.getNextTilePos().layer)).delete(t)}add(t,e){this.tilePosToCharacters.has(t)||this.tilePosToCharacters.set(t,new Set),this.tilePosToCharacters.get(t).add(e)}addTilePosSetSub(t){let e=t.tilePositionSet().subscribe(e=>{this.tilePosToCharacters.get(this.posToString(t.getNextTilePos().position,t.getNextTilePos().layer)).delete(t)});this.tilePosSetSubs.set(t.getId(),e)}addPositionChangeSub(i){let r=i.positionChangeStarted().subscribe(r=>{t.get().characterCollisionStrategy===e.BLOCK_ONE_TILE_AHEAD&&this.tilePosToCharacters.get(this.posToString(r.exitTile,r.exitLayer)).delete(i),this.add(this.posToString(r.enterTile,r.enterLayer),i)});this.positionChangeStartedSubs.set(i.getId(),r)}addPositionChangeFinishedSub(t){let e=t.positionChangeFinished().subscribe(e=>{this.tilePosToCharacters.get(this.posToString(e.exitTile,e.exitLayer)).delete(t)});this.positionChangeFinishedSubs.set(t.getId(),e)}posToString(t,e){return`${t.x}#${t.y}#${e}`}}}),ii=m(()=>{ke=class{constructor(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}isInRange(t){return t.x>=this.x&&t.x<this.x+this.width&&t.y>=this.y&&t.y<this.y+this.height}}}),ri=m(()=>{_(),ei(),ii(),(He=We=class{constructor(t){this.tilemap=t,this.characters=new Map,this.charBlockCache=new Ae,this.visLayerDepths=new Map,this.transitions=new Map,this.setLayerDepths()}addCharacter(t){this.characters.set(t.getId(),t),void 0===t.getNextTilePos().layer&&t.setTilePosition(y(f({},t.getNextTilePos()),{layer:this.getLowestCharLayer()})),this.charBlockCache.addCharacter(t)}removeCharacter(t){this.charBlockCache.removeCharacter(this.characters.get(t)),this.characters.delete(t)}getCharacters(){return[...this.characters.values()]}isBlocking(t,e,i){return this.hasNoTile(e,t)||this.hasBlockingTile(t,e,i)||this.hasBlockingChar(e,t)}hasBlockingTile(t,e,i){return!!this.hasNoTile(e,t)||this.getCollisionRelevantLayers(t).some(t=>this.isLayerBlockingAt(t,e,i))}getTransition(t,e){let i=this.transitions.get(t.toString());if(i)return i.get(e)}setTransition(t,e,i){this.transitions.has(t.toString())||this.transitions.set(t.toString(),new Map),this.transitions.get(t.toString()).set(e,i)}getTransitions(){return new Map([...this.transitions].map(([t,e])=>[t,new Map(e)]))}hasNoTile(t,e){return!this.getCollisionRelevantLayers(e).some(e=>this.tilemap.hasTileAt(t.x,t.y,e.name))}hasBlockingChar(t,e){return this.charBlockCache.isCharBlockingAt(t,e)}getTileWidth(){let t=this.tilemap.layers[0].tilemapLayer.scale;return this.tilemap.tileWidth*t}getTileHeight(){let t=this.tilemap.layers[0].tilemapLayer.scale;return this.tilemap.tileHeight*t}getDepthOfCharLayer(t){return this.visLayerDepths.get(t)||0}isInRange(t){return new ke(0,0,this.tilemap.width,this.tilemap.height).isInRange(t)}isLayerBlockingAt(e,i,r){let n=We.ONE_WAY_COLLIDE_PROP_PREFIX+r,s=this.tilemap.getTileAt(i.x,i.y-1,!1,e.name);return Boolean((null==s?void 0:s.properties)&&(s.properties[t.get().collisionTilePropertyName]||s.properties[n]))}getCharLayerIndexes(){return this.tilemap.layers.map((t,e)=>({layer:t,index:e})).filter(({layer:t})=>this.isCharLayer(t)).map(({index:t})=>t)}findPrevAndCharLayer(t){let e=this.getCharLayerIndexes(),i=e.findIndex(e=>this.getLayerProp(this.tilemap.layers[e],We.CHAR_LAYER_PROP_NAME)==t);return 0==i?{prevIndex:-1,charLayerIndex:e[i]}:{prevIndex:e[i-1],charLayerIndex:e[i]}}getCollisionRelevantLayers(t){if(!t)return this.tilemap.layers;let{prevIndex:e,charLayerIndex:i}=this.findPrevAndCharLayer(t);return this.tilemap.layers.slice(e+1,i+1)}getLowestCharLayer(){let t=this.tilemap.layers.find(t=>this.hasLayerProp(t,We.CHAR_LAYER_PROP_NAME));if(t)return this.getLayerProp(t,We.CHAR_LAYER_PROP_NAME)}getLayerProp(t,e){let i=t.properties.find(t=>t.name==e);return null==i?void 0:i.value}hasLayerProp(t,e){return null!=this.getLayerProp(t,e)}isLayerAlwaysOnTop(t){return this.hasLayerProp(t,We.ALWAYS_TOP_PROP_NAME)}isCharLayer(t){return this.hasLayerProp(t,We.CHAR_LAYER_PROP_NAME)}setLayerDepths(){let t=[],e=0,i=[];this.tilemap.layers.forEach((r,n)=>{this.isLayerAlwaysOnTop(r)&&i.push(r),this.hasLayerProp(r,We.HEIGHT_SHIFT_PROP_NAME)?(this.createLayerForEachRow(r,n,e),t.push(r.tilemapLayer),e+=r.height):r.tilemapLayer.setDepth(n+e),this.isCharLayer(r)&&(this.visLayerDepths.set(this.getLayerProp(r,We.CHAR_LAYER_PROP_NAME),n+e),e+=We.MAX_PLAYER_LAYERS)}),t.forEach(t=>t.destroy()),0==this.visLayerDepths.size&&i.forEach((t,r)=>{t.tilemapLayer.setDepth(We.MAX_PLAYER_LAYERS+r+e+this.tilemap.layers.length-i.length)})}createLayerForEachRow(t,e,i){let r=this.getLayerProp(t,We.HEIGHT_SHIFT_PROP_NAME);for(let n=0;n<t.height;n++){let s=this.tilemap.createBlankLayer(`${e}#${n}`,t.tilemapLayer.tileset);for(let e=0;e<t.width;e++)s.putTileAt(t.data[n][e],e,n);s.scale=t.tilemapLayer.scale;let o=.5;s.setDepth(i+n+r-1+o)}}}).MAX_PLAYER_LAYERS=1e3,He.ALWAYS_TOP_PROP_NAME="ge_alwaysTop",He.CHAR_LAYER_PROP_NAME="ge_charLayer",He.HEIGHT_SHIFT_PROP_NAME="ge_heightShift",He.ONE_WAY_COLLIDE_PROP_PREFIX="ge_collide_"}),ni=m(()=>{et(),et(),ze(),b(),qe(),Ze(),Ge=class{constructor(t=0,e=-1){this.delay=t,this.radius=e,this.numberOfDirections=O.FOUR,this.distanceUtils=new Re}setNumberOfDirections(t){this.numberOfDirections=t,t===O.EIGHT?this.distanceUtils=new De:this.distanceUtils=new Re}setCharacter(t){this.character=t,this.delayLeft=this.delay,this.initialRow=t.getNextTilePos().position.y,this.initialCol=t.getNextTilePos().position.x,this.stepSize=this.getRandomInt(this.radius)+1,this.stepsWalked=0,this.currentMovementDirection=w.NONE,this.character.positionChangeStarted().pipe(Ee(this.character.autoMovementSet())).subscribe(()=>{this.stepsWalked++})}update(t){if(this.shouldContinueWalkingCurrentDirection())this.character.move(this.currentMovementDirection);else if(this.delayLeft-=t,this.delayLeft<=0){this.delayLeft=this.delay;let t=this.getFreeRandomDirection();this.stepsWalked=0,this.character.move(t),this.currentMovementDirection=t,this.stepSize=this.getRandomInt(this.radius)+1}}shouldContinueWalkingCurrentDirection(){return this.stepsWalked<this.stepSize&&this.currentMovementDirection!==w.NONE&&!this.character.isBlockingDirection(this.currentMovementDirection)&&this.isWithinRadius(this.currentMovementDirection)}getFreeDirections(){return function(t){let e=[w.UP,w.RIGHT,w.DOWN,w.LEFT],i=[w.DOWN_LEFT,w.DOWN_RIGHT,w.UP_RIGHT,w.UP_LEFT];return t===O.EIGHT?[...e,...i]:e}(this.numberOfDirections).filter(t=>!this.character.isBlockingDirection(t)).filter(t=>this.isWithinRadius(t))}isWithinRadius(t){return-1==this.radius||this.getDist(t)<=this.radius}getDist(t){return this.distanceUtils.distance(this.character.getNextTilePos().position.add(E(t)),new r(this.initialCol,this.initialRow))}getFreeRandomDirection(){let t=this.getFreeDirections();return 0==t.length?w.NONE:t[this.getRandomInt(t.length)]}getRandomInt(t){return Math.floor(Math.random()*Math.floor(t))}}}),si=m(()=>{_(),P(),Ye(),ti(),Qe(),je(),et(),ri(),ni(),$e(),ze(),b(),Ve(),Je(),Be=class{constructor(t){this.scene=t,this.isCreated=!1,this.scene.sys.events.once("boot",this.boot,this)}boot(){this.scene.sys.events.on("update",this.update,this),this.scene.sys.events.on("destroy",this.destroy,this)}destroy(){this.scene=void 0,this.tilemap=void 0,this.gridCharacters=void 0,this.gridTilemap=void 0,this.movementStarted$=void 0,this.movementStopped$=void 0,this.directionChanged$=void 0,this.positionChangeStarted$=void 0,this.positionChangeFinished$=void 0,this.charRemoved$=void 0}getCharLayer(t){return this.initGuard(),this.unknownCharGuard(t),this.gridCharacters.get(t).getTilePos().layer}getTransition(t,e){return this.initGuard(),this.gridTilemap.getTransition(new r(t),e)}setTransition(t,e,i){return this.initGuard(),this.gridTilemap.setTransition(new r(t),e,i)}create(e,i){this.isCreated=!0,this.gridCharacters=new Map;let r=this.setConfigDefaults(i);t.set(r),this.tilemap=e,this.movementStopped$=new Jt,this.movementStarted$=new Jt,this.directionChanged$=new Jt,this.positionChangeStarted$=new Jt,this.positionChangeFinished$=new Jt,this.charRemoved$=new Jt,this.gridTilemap=new He(e),this.addCharacters()}getPosition(t){return this.initGuard(),this.unknownCharGuard(t),this.gridCharacters.get(t).getTilePos().position}move(t,e){this.moveChar(t,e)}moveRandomly(e,i=0,r=-1){this.initGuard(),this.unknownCharGuard(e);let n=new Ge(i,r);n.setNumberOfDirections(t.get().numberOfDirections),this.gridCharacters.get(e).setMovement(n)}moveTo(e,i,n){let s=this.assembleMoveToConfig(n);this.initGuard(),this.unknownCharGuard(e);let o=new Me(this.gridTilemap,{position:new r(i),layer:(null==n?void 0:n.targetLayer)||this.gridCharacters.get(e).getNextTilePos().layer},0,s);return o.setNumberOfDirections(t.get().numberOfDirections),this.gridCharacters.get(e).setMovement(o),o.finishedObs().pipe(be(1),function(t,e){return qt(function(i,r){var n=0;i.subscribe(new Zt(r,function(i){r.next(t.call(e,i,n++))}))})}(t=>({charId:e,position:t.position,result:t.result,description:t.description,layer:t.layer})))}stopMovement(t){this.initGuard(),this.unknownCharGuard(t),this.gridCharacters.get(t).setMovement(void 0)}setSpeed(t,e){this.initGuard(),this.unknownCharGuard(t),this.gridCharacters.get(t).setSpeed(e)}setWalkingAnimationMapping(t,e){this.initGuard(),this.unknownCharGuard(t),this.gridCharacters.get(t).setWalkingAnimationMapping(e)}update(t,e){if(this.isCreated&&this.gridCharacters)for(let[t,i]of this.gridCharacters)i.update(e)}addCharacter(t){this.initGuard();let e={sprite:t.sprite,speed:t.speed||4,tilemap:this.gridTilemap,tileSize:new r(this.gridTilemap.getTileWidth(),this.gridTilemap.getTileHeight()),walkingAnimationMapping:t.walkingAnimationMapping,container:t.container,offsetX:t.offsetX,offsetY:t.offsetY,collides:void 0===t.collides||t.collides,charLayer:t.charLayer},i=this.createCharacter(t.id,e);t.facingDirection&&i.turnTowards(t.facingDirection),this.gridCharacters.set(t.id,i);let n=t.startPosition?new r(t.startPosition):new r(0,0);i.setTilePosition({position:n,layer:i.getTilePos().layer}),this.gridTilemap.addCharacter(i),i.movementStopped().pipe(this.takeUntilCharRemoved(i.getId())).subscribe(t=>{this.movementStopped$.next({charId:i.getId(),direction:t})}),i.movementStarted().pipe(this.takeUntilCharRemoved(i.getId())).subscribe(t=>{this.movementStarted$.next({charId:i.getId(),direction:t})}),i.directionChanged().pipe(this.takeUntilCharRemoved(i.getId())).subscribe(t=>{this.directionChanged$.next({charId:i.getId(),direction:t})}),i.positionChangeStarted().pipe(this.takeUntilCharRemoved(i.getId())).subscribe(t=>{this.positionChangeStarted$.next(f({charId:i.getId()},t))}),i.positionChangeFinished().pipe(this.takeUntilCharRemoved(i.getId())).subscribe(t=>{this.positionChangeFinished$.next(f({charId:i.getId()},t))})}hasCharacter(t){return this.initGuard(),this.gridCharacters.has(t)}removeCharacter(t){this.initGuard(),this.unknownCharGuard(t),this.gridTilemap.removeCharacter(t),this.gridCharacters.delete(t),this.charRemoved$.next(t)}removeAllCharacters(){this.initGuard();for(let t of this.gridCharacters.keys())this.removeCharacter(t)}getAllCharacters(){return this.initGuard(),[...this.gridCharacters.keys()]}follow(e,i,r=0,n=!1){this.initGuard(),this.unknownCharGuard(e),this.unknownCharGuard(i);let s=new Fe(this.gridTilemap,this.gridCharacters.get(i),r,n?Ne.CLOSEST_REACHABLE:Ne.STOP);s.setNumberOfDirections(t.get().numberOfDirections),this.gridCharacters.get(e).setMovement(s)}isMoving(t){return this.initGuard(),this.unknownCharGuard(t),this.gridCharacters.get(t).isMoving()}getFacingDirection(t){return this.initGuard(),this.unknownCharGuard(t),this.gridCharacters.get(t).getFacingDirection()}getFacingPosition(t){return this.initGuard(),this.unknownCharGuard(t),this.gridCharacters.get(t).getFacingPosition()}turnTowards(t,e){return this.initGuard(),this.unknownCharGuard(t),this.gridCharacters.get(t).turnTowards(e)}setPosition(t,e,i){this.initGuard(),this.unknownCharGuard(t),i||this.gridCharacters.get(t).setTilePosition({position:new r(e),layer:this.gridCharacters.get(t).getTilePos().layer}),this.gridCharacters.get(t).setTilePosition({position:new r(e),layer:i})}getSprite(t){return this.initGuard(),this.unknownCharGuard(t),this.gridCharacters.get(t).getSprite()}setSprite(t,e){this.initGuard(),this.unknownCharGuard(t),this.gridCharacters.get(t).setSprite(e)}movementStarted(){return this.movementStarted$}movementStopped(){return this.movementStopped$}directionChanged(){return this.directionChanged$}positionChangeStarted(){return this.positionChangeStarted$}positionChangeFinished(){return this.positionChangeFinished$}setConfigDefaults(t){return f({collisionTilePropertyName:"ge_collide",numberOfDirections:O.FOUR,characterCollisionStrategy:e.BLOCK_TWO_TILES},t)}takeUntilCharRemoved(t){return Ee(this.charRemoved$.pipe(function(t,e){return qt(function(i,r){var n=0;i.subscribe(new Zt(r,function(i){return t.call(e,i,n++)&&r.next(i)}))})}(e=>e==t)))}initGuard(){if(!this.isCreated)throw new Error("Plugin not initialized. You need to call create() first.")}unknownCharGuard(t){if(!this.gridCharacters.has(t))throw new Error(`Character unknown: ${t}`)}createCharacter(t,e){return this._isIsometric()?new Oe(t,e):new we(t,e)}addCharacters(){t.get().characters.forEach(t=>this.addCharacter(t))}moveChar(e,i){if(this.initGuard(),this.unknownCharGuard(e),t.get().numberOfDirections===O.FOUR){if(!this._isIsometric()&&S(i))return void console.warn(`GridEngine: Character '${e}' can't be moved '${i}' in 4 direction mode.`);if(this._isIsometric()&&!S(i))return void console.warn(`GridEngine: Character '${e}' can't be moved '${i}' in 4 direction isometric mode.`)}this.gridCharacters.get(e).move(i)}_isIsometric(){return this.tilemap.orientation==`${Phaser.Tilemaps.Orientation.ISOMETRIC}`}assembleMoveToConfig(t){let e=y(f({},t),{noPathFoundStrategy:Ne.STOP,pathBlockedStrategy:Ie.WAIT});return(null==t?void 0:t.noPathFoundStrategy)&&(Object.values(Ne).includes(t.noPathFoundStrategy)?e.noPathFoundStrategy=t.noPathFoundStrategy:console.warn(`GridEngine: Unknown NoPathFoundStrategy '${t.noPathFoundStrategy}'. Falling back to '${Ne.STOP}'`)),(null==t?void 0:t.pathBlockedStrategy)&&(Object.values(Ie).includes(t.pathBlockedStrategy)?e.pathBlockedStrategy=t.pathBlockedStrategy:console.warn(`GridEngine: Unknown PathBlockedStrategy '${t.pathBlockedStrategy}'. Falling back to '${Ie.WAIT}'`)),e}}});return v((t,e)=>{si(),e.exports=Be})()})();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
